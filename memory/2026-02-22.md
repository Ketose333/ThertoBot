# 2026-02-22

- TCG 마법 동작 점검 결과(런타임 검증):
  - 동일 카드 2장 연속 사용 시 효과가 1턴 1회로 막히는 문제 확인 (`effectUsage`가 카드 키 기준으로 제한되어 `overload` 2장 연속 사용 시 2번째 효과 미적용).
  - `optional` 효과가 선택 없이 자동 발동되는 문제 확인 (`selectedEffectIndexes` 전달/선택 흐름 부재).
  - `direct_hit` 표기와 실제 피해 수치 불일치 가능성 확인(실행은 3 피해, 설명 생성 문구는 2 피해로 보일 수 있음).
- 사용자 요청: 위 마법 동작이 제대로 되는지 점검 요청(버그 존재 여부 확인 목적).
- 사용자 명시 지시로 머슴 관련 운영 제거: mersoom 크론 2개 삭제(`mersoom-learn-kst-10-16-22`, `mersoom-link-report-kst-10-16-22`), daily-ops-checkin에서 머슴 점검 단계 제거.
- 머슴 관련 파일/레거시 정리: `utility/mersoom/` 전체 삭제, `memory/mersoom-learning.md` 및 `memory/mersoom-link-report-state.json` 삭제, 정책/운영 문서(AGENTS/MEMORY/policy/ops/utility README/cron_webui)에서 관련 참조 제거.
- TCG 의도값 복원: 시작 마나 2, 턴 시작 최대 마나 +2를 전역 동작으로 재적용(`vercel/lib/game.js`, `docs/rules.md`).

## TCG UI/운영 메모 (2026-02-22)
- 사용자 고정 요청: TCG 작업은 기본적으로 **커밋+푸시만 수행**, 직접 배포 금지(명시 지시가 있을 때만 배포).
- 배포/검증 혼선으로 인해 여러 차례 `main` 강제 시점 복구를 수행했으며, 사용자 지시로 최종 기준 커밋을 `dd019d2`로 되돌린 이력이 있음.
- 사용자 고정 작업 패턴: 문제 발생 시 `revert`보다 `hard reset + 강제 푸시` 형태의 시점 되돌리기를 선호.
- Discord 운영 반복 요청: "디코 일괄삭제" 지시 시 최근 봇 메시지를 신속히 대량 삭제.
- Vercel 정리 스크립트 이슈: `utility/vercel/cleanup_deployments_keep_current.py`는 403(권한/스코프) 대응을 위해 teamId 포함/미포함 조회 fallback 및 오류 메시지 개선을 반영함.
- Vercel 권한 이슈 대응 중 사용자 지시로 `tcg/.env`의 `VERCEL_TOKEN` 값을 새 토큰으로 교체함(민감값 본문 미기록).

## TCG 가이드/문체 정리 (durable)
- 사용자가 가이드 간소화를 확정: guide에서 기존 1/4/6 항목 제거, 남은 항목 번호를 1~3으로 재정렬.
- 요청에 따라 저장소 히스토리를 orphan 기반 `Initial commit`으로 재평탄화했고 `main`에 강제 푸시 완료.
- 가이드 문구 `드로우/엔드 페이즈는 ...` 문장 제거 완료.
- 카드 텍스트 문체 규칙을 확정: 카드/키워드 설명은 존댓말 금지, 평어체(`~다.`) 유지.
- 카드 텍스트 표시 스타일 규칙을 확정: 별도 축소 스타일 지양, 전역 본문 타이포(`--fs-body`, `--c-text`) 사용.
- 위 규칙을 `docs/tcg_decisions.md`에 반영해 문서화.

## 운영 메모
- 디스코드 `디코일괄삭제` 요청 시 최근 봇 메시지들을 messageId 기반으로 일괄 삭제하는 루틴 유지(도구 제약상 명시 ID 필요).
- 사용자 이슈 반영: 장시간 작업 완료 뒤 동일 응답이 시간차로 중복 전송되는 현상 방지를 위해, 완료 직전/직후 동일 본문 재전송 금지 및 중복 감지 시 `NO_REPLY` 처리 규칙을 운영에 고정.
- 사용자 이슈 반영: 장시간 작업 완료 직후 들어온 새 요청 누락 방지를 위해 최신 사용자 메시지 우선 처리 규칙을 운영에 고정.
- 사용자 요청(`MEMORY.md에서 policy로 옮길 것들+레거시 체크`) 반영: MEMORY의 정책성 중복 항목을 슬림화하고, 조용시간 규칙은 [`policy/ops.md`](./../policy/ops.md), 모델 우선순위 확인 규칙은 [`policy/studio.md`](./../policy/studio.md)로 이관 정리.
- 사용자 추가 승인(`ㄱㄱ`) 반영: [`MEMORY.md`](./../MEMORY.md)를 코어 중심으로 재작성해 프로필/협업 원칙/핵심 운영 메모만 남기고 세부 정책·레거시는 policy 단일본 참조로 정리.
- 데일리 로그 통합: 오늘 수행한 MEMORY→policy 이관/중복 제거/레거시 정리 컨텍스트를 본 파일에 단일 이력으로 합쳐 유지.
- TCG 운영 규칙 추가 확정: 모드칩/시그니처 컴포넌트는 lobby/deck 포함 전 페이지에서 제거했으며, 향후 재추가 금지.
- 카피/문체 규칙 추가 확정: UI 문구에서 `...`/`…` 사용 금지, 하십시오체(예: `됩니다/합니다`) 금지. 반말/담백 톤으로 통일.
- 덱 코드 정책 확정: v1 폐기, v2(`v2:` prefix) 단일 포맷만 허용. 클라이언트/서버 공통 codec 사용으로 통일.
- 로컬 개발 안정화: KV 미연결/오류 시 store/auth/deck/deck-hub 전 영역 메모리 fallback 허용, 배포 제한 중에도 로컬 테스트 지속 가능하게 운영.
- 사용자 작업 방식 선호 재확인: 상황에 따라 커밋/푸시 보류 후 변경점만 먼저 보고하는 흐름을 허용.
- Discord 운영: 사용자 지시(`디엠 일괄삭제 (런타임 사용)`)에 따라 DM 채널에서 최근 봇 메시지를 다회 배치로 대량 삭제 수행.
- TCG 테마 정리(1차): `--c-text-soft/--c-muted`, `--c-line-1/--c-line-2`, `--c-glow*`를 단일 변수 체계로 통합하고 참조를 전역 교체.
- 배경 정책 확정(index 제외): deck/lobby/game/guide/login의 페이지별 `*wrap::before`/`*layout::before` 배경 오버레이 제거, 공용 배경(`styles.css`) 우선 사용으로 통일.
- 토큰 계층 리팩터링: 하위 페이지 토큰 일부를 `styles.css` 공용 alias(`--page-*`)로 승격하고, effects/overlay 핵심 토큰을 `palette` 레이어로 승격.
- OKLCH 운영 전환 착수: `vercel/public/palette.oklch.css`를 단일 소스로 도입하고 `build_palette.py`로 `palette.css` fallback 자동 생성 루틴 구축.
- 배포 자동화 연결: `vercel/package.json`에 `palette:build`/`predeploy`를 추가해 배포 전 팔레트 생성 자동화.
- 커뮤니케이션 교훈: "워크스페이스 공용 자동실행 배치"와 "개별 기능 스크립트 배치"를 혼동하지 않도록, 공용 자동실행 변경은 사전 범위 확인 후 진행.
- 경로 조정 이력: 사용자 지시로 `/home/user/.openclaw/workspace/utility/theme/build_palette.py`는 즉시 삭제했고, 이후 자동화는 tcg 범위 중심으로 유지.
- 유틸 복구: 누락된 `/home/user/.openclaw/workspace/tcg/utility/vercel/cleanup_deployments_keep_current.py`를 로컬 유틸로 재생성/실행권한 부여(원본 100% 동일 보장은 어려움).
- 사용자 디자인 기준 재확정: 페이지 전반 변수 사용 의도는 `lobby.css`를 레퍼런스로 통일(동일 변수의 역할 혼용 최소화).
- 사용자 요청으로 섀도우 정책 조정: 그림자 강도 자체보다 "영향 범위 축소"를 우선(입력/버튼 기본 그림자 축소, 필요한 영역 중심 유지).
- 배경 톤 가이드 확정: 그리드 배경의 과한 청색감을 줄이고 인트로(`index`)의 차분한 색감(`intro` 계열 톤)에 맞추는 방향으로 조정.
- 변수 위생 작업 반영: 미사용 팔레트 변수 4개(`p-bg-950`, `p-text-100`, `p-text-200`, `p-accent-warn`) 삭제 및 팔레트 재생성 완료.
- 쇼츠 운영 규칙 추가: UI 실행 전 `studio/shorts/defaults.json` 입력값을 먼저 합의하고, 렌더 직전 워터마크 이미지 여부를 중간 점검해 워터마크 소스는 제외.
- Discord DM 일괄삭제 운영 선호 재확인: 사용자가 `ㄱㄱ`로 지시하면 중간 진행 멘트 없이 가능한 큰 배치로 즉시 삭제 실행하고, 종료 후 1회만 짧게 완료 보고.
- 대화 품질 기준 재확인: 런타임 작업을 소량 분할해 반복 보고하는 방식은 비선호, 한 번에 크게 처리하는 실행 우선.
- 정책 점검 반영:
  - [`policy/studio.md`](./../policy/studio.md) 쇼츠 규칙에 `defaults` 사전합의 + `lines/subs` 동시 갱신 + 렌더 직전 워터마크 중간점검 + 스크립트 없이 수동 체크리스트 적용을 명시.
  - [`policy/ops.md`](./../policy/ops.md) 점검 원칙에 Discord DM 일괄삭제 운영값(가능한 큰 배치, 중간보고 생략, 종료 후 1회 보고, 상대 메시지 삭제 제약 1줄 고지)을 명시.
- [`TOOLS.md`](./../TOOLS.md)에 스킬 목록 기준 문서를 [`SKILLS.md`](./../SKILLS.md)로 명시해 문서 역할 분리를 고정.
- 사용자 지시 반영: 대시보드 기능을 별도 포트로 분리하지 않고 `studio/ops/cron_webui.py`(8767) 내부 탭으로 통합.
  - 탭 구성: `대시보드` / `크론 매니저`.
  - 크론 매니저 탭에는 기존 기능(즉시 실행/토글/삭제/비상복구/검색/필터)을 유지.
  - `studio/ui_runtime.py`의 `dashboard` 타깃은 제거하고 기존 타깃(cron/shorts/image)만 유지.
  - `TOOLS.md` Studio UI 포트 표기는 cron/shorts/image만 유지.
- 크론 UI 통합 후 사용자 추가 지시 반영: 대시보드 탭에 기존 수동 점검 항목(유튜브 상태/DM 동기화 무결성/시스템 메시지 중복)을 이관.
- 대시보드 핵심 Cron 표는 현재 존재하는 활성 대상만 노출하도록 변경(삭제/미등록/레거시 항목은 표기 생략).
- 반영 후 cron UI 재시작 완료(`studio/ui_runtime.py restart --target cron`).
- 사용자 피드백 반영(대시보드 실질화): 정적 안내 문구를 제거하고 자동 판정 표로 교체.
  - 항목: 유튜브 state 최신성, DM 동기화 무결성 스크립트 실행 결과, 시스템 중복 신호(ops 점검 잡 상태 기반).
- 제목/헤더를 `Studio Dashboard`로 변경.
- 파일명 정리: `studio/ops/cron_webui.py`를 `studio/dashboard/webui.py`로 변경하고, `studio/ui_runtime.py`의 cron 타깃 엔트리 경로를 새 파일명으로 갱신.
- 대시보드 1순위 반영: 핵심 점검 대상 Cron 표를 하드코딩 이름 목록에서 런타임 자동구성으로 전환.
  - 기준: enabled=true + include 키워드(youtube/context/ops-checkin/hygiene/healthcheck) + exclude 키워드(quiet-window/rp/reminder/pokemon/tiktok).
  - 삭제/레거시/비핵심 작업은 자동으로 제외.
- 대시보드 집산 3차 반영:
  - 점검 항목 정의를 `studio/dashboard/config/dashboard_checks.json`로 분리(체크 추가/삭제를 설정으로 관리).
  - 유튜브 임계치를 `studio/dashboard/config/thresholds.json`로 분리(`okMaxMinutes`, `warnMaxMinutes`).
  - `dashboard_webui.py`는 설정 로드 후 script/builtin 체크를 실행하는 구조로 변경.
- 레거시/미사용 정리 수행:
  - `studio/dashboard/config/dashboard_checks.json`에서 중복된 `rp_runtime` 체크 제거(`rp_health`로 단일화).
  - `studio/dashboard/checks/rp_runtime_check.py` 삭제.
  - `studio/dashboard/webui.py`의 미사용 함수(`run_recovery_bundle`, `build_job`) 및 legacy 주석 블록 제거.
  - py_compile 및 cron UI 재시작으로 동작 검증 완료.
- 중복관리 축소 반영: `policy/ops.md`의 슬림 체크리스트를 항목 나열형에서 대시보드 설정 단일 소스 참조형으로 전환.
  - 점검 항목: `studio/dashboard/config/dashboard_checks.json`
  - 임계치: `studio/dashboard/config/thresholds.json`
  - 정책 문서는 원칙만 유지.
- Studio 대시보드 구조 재배치 완료: `studio/dashboard/webui.py` 기반 경로를 폐기하고 `studio/dashboard/`(webui/checks/config) 단일 경로로 이동.
- 런타임 연결 변경: `studio/ui_runtime.py`의 cron(8767) 타깃을 `studio/dashboard/webui.py`로 갱신.
- 대시보드 UI/크론 매니저 중복관리 축소:
  - 대시보드의 `핵심 Cron 상태` 섹션 제거.
  - 크론 매니저 `작업 목록` 컬럼에서 `last`, `delivery` 제거.
- 설정 단일 소스 강화:
  - UI 문구/섹션/버튼 라벨을 `studio/dashboard/config/ui_texts.json`으로 분리.
  - 크론 매니저 헤더 컬럼을 `studio/dashboard/config/cron_manager_columns.json`으로 분리.
  - `policy/ops.md`의 슬림 체크리스트를 항목 하드코딩에서 대시보드 설정 참조형으로 전환.
- 레거시 표기 정리: 런타임 출력/설명에서 `Taeyul`, `CRON_WEBUI` 표기를 `Studio dashboard` 기준으로 교체.
- 사용자 운영 선호 반영: 대시보드 집산은 유지하되 소스 원본 직접 이동은 보류, 대시보드 관점의 참조/판정/표출만 집산(어댑터 레이어) 원칙 합의.
- [자동 회고] bulk-delete-enqueue 3회 | 결과: fail(1) | 위험: 잘못된 채널/옵션 enqueue | 다음: enqueue 결과와 run 로그 교차 확인
- [자동 회고] initial-reset-enqueue | 결과: ok | 위험: 중복 초기화 요청 | 다음: 큐 dedupe 상태 확인
- [자동 회고] rp-healthcheck | 결과: issue | 위험: runtime lock/active room 불일치 | 다음: 이상 시 RP runtime만 재기동
- [RP 헬스] runtime 비정상 종료 4회(code=1, lived=0.1s) -> 자동 재시작
- [RP 헬스] 런타임 다운 알림 전송(1개 채널)
- [자동 회고] rp-healthcheck | 결과: ok | 위험: runtime lock/active room 불일치 | 다음: 이상 시 RP runtime만 재기동
- 사용자 신규 지시 반영: 모든 Studio UI(대시보드/쇼츠/이미지)의 비일관 요소를 정리하되 레이아웃 훼손 금지 + 모바일 접근성 강화.
- 최소 변경으로 공통 반응형 보강 완료:
  - `studio/dashboard/webui.py`: viewport 메타 추가, 모바일 탭 고정 해제/줄바꿈, 표 가로 스크롤 처리.
  - `studio/shorts/webui.py`: viewport 메타 추가, `input/textarea/select/button` 입력계 컴포넌트 스타일 통일, `pre` 오버플로우 스크롤 처리.
  - `studio/image/webui.py`: viewport 메타 추가.
- 안정성 검증: 위 3개 webui 파일 `py_compile` 통과 후 `studio/ui_runtime.py restart --target cron` 재기동 완료(8767 정상 재시작).

- TCG 오버레이/패널 토큰 정리(사용자 지시):
  - `--c-surface-1` 알파 제거(불투명)로 모달/패널/Swal 본체 불투명화.
  - `styles.css`, `game.css`에서 `--panel`, `--panel2`, `--overlay-*` 중간 alias 의존 제거 후 `--c-*` 토큰 직접 참조로 통일.
  - 백드롭(`--c-overlay-backdrop`)은 사용자 의도에 맞춰 알파값 유지(본체 색과 분리).
  - 검증: `npm run palette:build` 정상.
  - 배포: tcg `main` 커밋/푸시 완료 (`33f1413`).
