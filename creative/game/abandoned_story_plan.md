## 목적

문서 구조 정리를 마친 뒤, 실제 게임 구현에 바로 연결되는 수준으로 규칙을 고정한다.

---

## 0) 진행 원칙

- 당분간 레포 커밋/푸시는 진행하지 않는다.
- 설정은 서사 문장으로 설명하되, 각 항목마다 최소 1개의 판정 기준을 함께 둔다.
- 추상적 표현은 유지하되, "언제/무엇으로/어떻게"가 보이도록 작성한다.

---

## 1) 정식 스펙 A — 퇴장 절차 실패의 3단계화

퇴장 절차 실패는, 방문자가 자신의 세계로부터 밀려나는 과정으로 취급한다.

플레이어는 실패를 반복할수록 공간보다 먼저 "자기 인식"이 무너지는 압박을 체감한다.

### 적용 방식

- 퇴장 절차 시도 실패가 누적될 때마다 단계가 1씩 상승한다.
- 단계는 최대 3단계까지 적용한다.

### 단계 정의

1. **1단계: 공간 불안정화**
    - 복도 반복, 문 위치 어긋남, 환각 빈도 증가를 노출한다.
    - 연출은 공간 중심으로, 인물 기억은 아직 유지된다.
2. **2단계: 자아 흔들림**
    - 이름/목적/동행자 인식이 부분적으로 흔들리는 사건을 발생시킨다.
    - 같은 선택지를 다시 보게 하거나, 기억 서술이 어긋나는 방식으로 표현한다.
3. **3단계: 귀속 붕괴 직전**
    - 방문자가 "여기에서 사라지는" 감각을 직접 자각하게 한다.
    - 버려진 이 전이 위험을 명시하고, 회복 가능한 선택지를 제한한다.

### 구현 기준

- 실패 카운트 정수값(`exit_fail_count`)으로 단계 판정.
- 단계 변화 시 즉시 시각/대사/사운드 피드백 1회 이상 출력.

---

## 2) 정식 스펙 B — NORMAL/TRUE 엔딩 분기 고정

엔딩은 감정 해석이 아니라, 플레이어가 끝까지 어떤 구원을 선택했는지로 판정한다.

핵심 축은 네임드 귀신 성불 수다.

### 분기 기준

- 대상 네임드: **흉내내기 / 화재 / 추락 / 상대적 시간** (총 4체)
- **NORMAL**: 성불 0~1체
- **TRUE**: 성불 2~4체

### 성불 인정 조건

- 단순 제압/회피는 불인정.
- 해당 귀신의 "핵심 미련 해소 조건" 충족 시에만 인정.
- 한 귀신은 1회만 집계.

### 집계 시점

- 최종 퇴장 절차 직전 1회 고정 집계.

### 구현 기준

- 귀신별 Boolean 상태(`released_named_ghost_x`)를 저장.
- 집계 결과를 엔딩 분기 플래그로 즉시 변환.

---

## 3) 정식 스펙 C — 입장 트리거 정량화

백회빌라 유입은 "우연히 빨려 들어감"이 아니라,

인식이 얇아진 순간에 신기루가 문처럼 열리는 사건으로 다룬다.

---

## 4) 정식 스펙 D — 여권 프로토콜 예외 규정

여권은 세계 귀속의 임시 증명으로 간주한다.

이 문서는 "예외 상황에서도 규칙이 무너지지 않게" 하는 안전장치다.

### 기본 원칙

- 방문자 1인당 유효 여권 1개만 허용.
- 상태 흐름: 발급 → 검증 → 유지/파기/양도.

### 예외 규정

1. **분실**
    - 즉시 무효 처리.
    - 관리실 대면 검증 후 재발급 가능.
2. **훼손**
    - 핵심 식별면 훼손 시 검증 실패.
    - 재발급 시 기존 여권 자동 파기.
3. **위조 시도**
    - 즉시 무효.
    - 적발 시 퇴장 절차 실패 누적 +1.
4. **이중 소유 시도**
    - 신규 발급 순간 기존 여권 자동 소멸.
    - 동시 유효 상태는 허용하지 않음.
5. **양도 예외**
    - 방문자 → 버려진 이 단방향만 허용.
    - 양도 완료 시 원 소유자 방문자 자격 즉시 상실.

### 구현 기준

- 발급/재발급/양도/파기 이벤트를 모두 로그로 남김.
- 엔딩 판정 전 마지막 유효 상태를 최종 참조값으로 사용.

---

## 5) 후속 보완 후보 (잔여)

1. 관리자 권한 한계 명시 (가능/불가 행위 경계)
2. 네임드 귀신별 시험 유형 차별화 (공포 연출 + 역할 분리)
3. 석수진 장기 목적 고정 (조력자 기능과 감정선 일치)

---

## 6) 현재 합의 요약

- 퇴장 실패는 3단계 붕괴 구조로 확정한다.
- 엔딩은 네임드 귀신 성불 수 기반으로 확정한다.
- 입장 트리거와 여권 예외는 서사-시스템 겸용 규칙으로 운영한다.
- 문장은 서사 톤을 유지하되, 구현 가능 판정 기준을 반드시 포함한다.