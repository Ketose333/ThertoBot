# policy/studio.md — 이미지/쇼츠 운영 정책 단일본

## 단일 소스
- 이미지 생성/품질 판정 기준은 [`studio/image/rules/image_rules.md`](../studio/image/rules/image_rules.md)를 따른다.

## 기본 운영
- 기본 저장/첨부/파일명 정책은 [`policy/media.md`](./media.md)를 따른다.
- 이미지 모델 기본값은 `nano-banana-pro-preview`를 사용한다.
- `nano-banana-pro-preview` 실패 시 `gemini-2.5-flash-image`로 자동 fallback한다.
- **비율 명시가 없으면 무조건 `1:1`을 기본값으로 고정**한다.
- 사용자가 별도 비율(예: 4:5, 9:16)을 명시한 경우에만 예외 적용한다.
- TTS 기본 보이스는 `Fenrir`로 고정하고, 사용자 명시 요청이 있을 때만 변경한다.
- Veo 기본 비율은 `1:1`로 고정하고, 사용자 명시 요청이 있을 때만 변경한다.
- 생성 실패 시 프롬프트/모델은 한 번에 한 요소만 조정한다.
- 모델 우선순위 혼선이 생기면 `openai-codex/gpt-5.3-codex`를 우선 기준으로 확인/복구한다.
- fallback 전환 기준은 아래 순서를 고정한다:
  1) Web 수집 성공 + 품질 기준 통과 → Web 사용 유지
  2) Web 수집 실패 또는 품질 기준 미달 → YouTube fallback
  3) YouTube도 실패/품질 미달이고 AI 옵션이 ON일 때만 AI 보조 사용

## 기본값/예외 요약 (혼선 방지)
- Image: 기본 모델 `nano-banana-pro-preview`, 기본 비율 `1:1`
- TTS(일반): 기본 보이스 `Fenrir`
- Veo: 기본 모델 `models/veo-3.1-generate-preview`, 기본 비율 `1:1`
- Shorts: 파이프라인 기본 보이스 `Charon` (쇼츠 도메인 전용 예외)
- 공통 원칙: 사용자 명시 요청이 있으면 위 기본값보다 사용자 지시를 우선한다

## 생성 요청 처리 원칙 (강화)
- 사용자가 "만들어줘/생성해줘/올려줘"를 말하면, 설명보다 **생성 실행을 우선**한다.
- 실행이 30초 이상 걸리면 중간 상태를 1문장으로 알리고, 완료 즉시 결과 파일을 전달한다.
- 생성 작업 중 heartbeat/부가 점검 메시지가 오더라도, 사용자 생성 요청 진행 상태를 잃지 않고 이어서 완료한다.
- 긴 대화/다세션 이후에도 마지막 요청보다 **현재 턴의 생성 지시**를 우선한다(문맥 드리프트 방지).

## 과적합 방지 원칙
- 프로필/정체성 보정은 기본값을 유지하되, 사용자 요청 키워드를 덮어쓰지 않는다.
- 요청에 없는 고정 연출(특정 배경/특정 의상/특정 구도)을 강제하지 않는다.
- 규칙 위반 시 재생성은 하되, 같은 실패 패턴을 반복하지 않도록 프롬프트 요소는 1개씩만 조정한다.

## UI 통합 수칙 (신규 UI 공통)
- 새 UI는 기존 UI와 동일한 입력/결과 메커니즘을 우선 재사용한다(동일 기능 중복 구현 금지).
- 업로드 대상 선택은 공통 allowlist([`studio/publish_channels_allowlist.json`](../studio/publish_channels_allowlist.json))를 사용한다.
- 업로드 동작은 "채널 선택 = 자동 업로드"로 통일하고, 별도 체크박스 게이트를 추가하지 않는다.
- 결과 표시 포맷은 `결과:` + `실행 로그:` 구조를 기본으로 통일한다.
- 파일명 규칙은 [`policy/media.md`](./media.md)의 언더스코어 슬러그(`<topic>_<variant>.<ext>`)를 따른다.
- 로컬 실행/재기동은 통합 런타임([`studio/ui_runtime.py`](../studio/ui_runtime.py))으로 관리한다.
- 기능 확장은 기본적으로 비활성/옵션으로 추가하고, 기존 UX/기능 기본값을 깨지 않는다.

## 쇼츠
- 레터박스 기본값은 `top-h=600`, `bottom-h=600`을 유지한다.
- 이미지 소스는 Web 우선, 실패/품질 저하 시 YouTube fallback, AI는 옵션 ON일 때만 보조로 사용한다.
- 작업 흐름은 "초안 작성 → UI 미세조정 → 렌더" 순서를 유지한다.
- 운영 흐름은 "내가 제목/부제목 초안 작성 → 승세가 UI 최종 수치/문구 미세조정 → 렌더" 순서를 기본으로 한다.
- UI 실행 전 [`studio/shorts/defaults.json`](../studio/shorts/defaults.json) 입력값(주제/경로)을 먼저 합의한다.
- `lines`/`subs` 파일은 defaults와 같은 턴에 함께 갱신한다.
- 렌더 직전 워터마크 이미지 사용 여부를 중간 점검하고, 워터마크 소스는 기본 제외한다.
- 별도 점검 스크립트가 없어도 위 합의/점검 절차를 수동 체크리스트로 동일 적용한다.
